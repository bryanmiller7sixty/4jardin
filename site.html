<!DOCTYPE html>
<html>
    <head>
	     <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
	     <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>


    </head>
    <body>
	<script>
		var uID = 0;
		function login(){
			$.getJSON( "/login",  { "username": $('#user').val(), "password": $('#pass').val()} ,  function( json ) {
				//If response is 1 (true) then the data existed in the db other return 0 (false) the credentials are invalid
				//$('#test').append(JSON.stringify(json.data.uID))
				if(JSON.stringify(json.data.bln) == JSON.stringify(1)){
					uID = JSON.stringify(json.data.uID)
					alert("Login success");
					$('#login').hide();
					$('#book_list').show();
					populateBooks()
				}else{
					alert("Incorrect username or password");
				}
			});
		}
		function register(){
                        $.getJSON( "/register",  { "username": $('#user').val(), "password": $('#pass').val()} ,  function( json ) {
                                //If response is 0 (false) then the username was already taken otherwise 1 (true) the credentials are valid
				//$('#test').append(JSON.stringify(json.data.uID))
				if(JSON.stringify(json.data.bln) == JSON.stringify(1)){
                                        alert("Successfully registered, logging in");
					uID = JSON.stringify(json.data.uID)
					$('#login').hide();
					$('#book_list').show();
                                        populateBooks()
                                }else{
                                        alert("Username already taken");
                                }
                        });
                }
		function populateBooks(){
			$.getJSON( "/popBooks",  function( json ) {
				
				$('#Book1').append(json.data[0][1]);
				$('#text1').append(json.data[0][2] + "$");
				$('#id1').append(json.data[0][0])
				$('#Book2').append(json.data[1][1]);
				$('#text2').append(json.data[1][2] + "$");
				$('#id2').append(json.data[1][0])
				$('#Book3').append(json.data[2][1]);
				$('#text3').append(json.data[2][2] + "$");
				$('#id3').append(json.data[2][0])
			});
		}
		function purchase(bid){
			alert("Thank you for your purchase!")
			$.getJSON( "/purchase",  { "uid": uID, "bid": bid} ,  function( json ) {
				alert(json.data)
			});
		}
	</script>
            <div id="login" class="action" style="margin:0 auto;">
  			<label for="username">Username:</label><br>
			<input type="text" id="user"><br>
  			<label for="lname">Password:</label><br>
			<input type="password" id="pass"><br><br>
	    		<button onclick="login()">Login</button>
			<button onclick="register()">Register</button>
	    </div>
	    <div id = "book_list" style="display:none">
	    
		    <div class="card-group">
  			<div class="card">
    				<img src="https://m.media-amazon.com/images/I/517BoP3mGrL.jpg" class="card-img-top" alt="..." width="400" height="400">
				<div id="Book1"></div>
    				<a href="#" class="btn btn-primary" onclick="purchase(document.getElementById('id1').innerHTML)">
					<p id="text1"></p>
				</a>
					<p id="id1" style="display:none"></p>
			</div>
			<div class="card">
                                <img src="https://img.btdmp.com/10063/10063454/products/0x2048@1581917617ddf3d0cc98.jpeg" class="card-img-top" alt="..." width="400" height="400">
				<div id="Book2"></div>
                        	<a href="#" class="btn btn-primary" onclick="purchase(document.getElementById('id2').innerHTML)">
					<p id="text2"></p>
				</a>
					<p id="id2" style="display:none"></p>
			</div>
			<div class="card">
                                <img src="https://images-na.ssl-images-amazon.com/images/I/91-O3ok9mQL.jpg" class="card-img-top" alt="..." width="400" height="400">
				<div id="Book3"></div>
				<a href="#" class="btn btn-primary" onclick="purchase(document.getElementById('id3').innerHTML)">
					<p id="text3"></p>
				</a>
					<p id="id3" style="display:none"></p>
                        </div>
  		    </div>
	    </div>
    </body>
</html>
